---
title: "crosswords"
author: "paolo pasco"
date: "3/20/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(janitor)
library(readxl)
```

```{r reading, echo=FALSE}
nyt <- read_excel("raw-data/NYT_Crossword_2009_2016.xlsx") %>%
  select(-Explanation) %>%
  mutate(Word = map(Word, ~ str_split(., "[(]"))) %>%
  unnest(Word) %>%
  mutate(Word = map(Word, ~ .[1])) %>%
  mutate(Word = map(Word, ~ str_replace_all(., "[[:punct:]]|\\s", ""))) %>%
  mutate(Outlet = "NYT") %>%
  select(-Total)

# Finding the top ten most frequently appearing words in the NY times crossword.
# Surprised personally that ONO isn't on the list, but it falls just short at 59
# appearances. Still hoping to do the same with the LA times crossword, but
# scraping is proving to be an interesting process. Added some of the scraped LA
# times .csv file to show the state of things; still working on how to separate
# them into lines

nyttop10 <- nyt %>%
  unnest(Word) %>%
  group_by(Word) %>%
  summarize(times=n()) %>%
  arrange(desc(times)) %>%
  slice(1:10)

# Slider for date
# Different difficulty for word length?

# Creating the graph! Stole the labeling idea from the latest problem set, so
# thank you very much for that.

ggplot(nyttop10, aes(x=reorder(Word, -times), y=times)) + geom_col() +
  xlab("Word") +
  ylab("Number of Appearances") +
  ggtitle("Ten most common words in the New York Times crossword",
          subtitle="Based on crosswords from 2009-2016") +
  geom_text(aes(y=times + 3, label=times))
```

```{r lat, echo = FALSE}

latimes <- read.csv("raw-data/latimes2.csv", header=FALSE,
                    col.names = c("web.scraper.start.url", "clues"))

latimes2 <- latimes %>%
  
  # Getting the clues onto their own lines
  
  mutate(clues = map(clues, ~ str_split(., "[1234567890]+[.]"))) %>%
  unnest(clues) %>%
  unnest(clues) %>%
  mutate(clues = map(clues, ~str_split(., "  "))) %>%
  unnest(clues) %>%
  mutate(Clue = map(clues, ~.[2]),
         Word = map(clues, ~.[3])) %>%
  filter(!is.na(Word)) %>%
  select(-c(clues)) %>%
  
  # Getting parentheticals out of words
  mutate(Word = map(Word, ~ str_split(., "[ ]+[(]"))) %>%
  unnest(Word) %>%
  mutate(Word = map(Word, ~ .[1])) %>%
  mutate(Word = map(Word, ~ str_replace_all(., "[[:punct:]]|\\s", ""))) %>%
  
  # Separating out weekdays, getting dates into workable format
  
  rename(date = web.scraper.start.url)%>%
  mutate(date = map(date, ~str_split(., "/"))) %>%
  unnest(date) %>%
  mutate(Year = as.double(map_chr(date, ~ .[4])),
         date = map(date, ~ paste(.[4],.[5],.[6], sep = "-"))) %>%
  mutate(date = map(date, ~ as.Date(.)),
         Weekday = map_chr(date, ~weekdays(., abbreviate=TRUE))) %>%
  select(-date) %>%
  unnest(Clue) %>%
  mutate(Outlet = "LAT")
```

```{r binding, echo=FALSE}
joined <- bind_rows(nyt, latimes2)
```

```{r analyze, echo=FALSE}

# Function that finds the length of a given entry, stripping spaces and punctuation
wordlen <- function(word) {
  new <- str_replace_all(word, "[[:punct:]]|\\s", "")
  str_length(new)
}

# Average word length vs. day of week

total_length <- function(x) {
   total_temp <- mutate(x, length = wordlen(x$Word))
   summarize(total_temp, sum = sum(total_temp$length))
}

# Finding the average word length by day of week in LA Times crosswords

latimes_avg <- latimes2 %>%
  mutate(length = wordlen(Word)) %>%
  group_by(date) %>%
  summarize(weekday = weekday[1],
            avg_length = sum(length)/n())

# Graphing average word length by day of week in LA Times crosswords

latimes_avg %>%
  mutate(weekday = fct_relevel(weekday, "Monday", "Tuesday", "Wednesday", "Thursday",
                               "Friday", "Saturday", "Sunday")) %>%
  ggplot(aes(x = weekday, y = avg_length)) +
  geom_boxplot() +
  labs(x = "Weekday", y = "Average Word Length",
       title = "Average Word Length of LAT Crosswords by Weekday")

# Doing the same for NYT puzzles

nyt_avg <- nyt %>%
  mutate(length = wordlen(Word)) %>%
  group_by(Year,Weekday) %>%
  summarize(avg_length = sum(length)/n())

nyt_avg %>%
  mutate(Weekday = fct_relevel(Weekday, "Mon", "Tue", "Wed", "Thu",
                               "Fri", "Sat", "Sun")) %>%
  ggplot(aes(x = Weekday, y = avg_length)) +
  geom_boxplot() +
  labs(x = "Weekday", y = "Average Word Length",
       title = "Average Word Length of NYT Crosswords by Weekday")
```

```{r writing, echo = FALSE}
write_rds(latimes2, "final_shiny/latimes.rds")
write_rds(nyt, "final_shiny/nytimes.rds")
write_rds(joined, "final_shiny/joined.rds")
```

```{r uniqueness, echo = FALSE}

# What clues/answers show up more often in more difficult (i.e. later-week) puzzles?

```

```{r references, echo = FALSE}

# Does the LA Times crossword reference certain people/places more than the NY
# Times puzzle? What about geographic/country/gender diversity of references?

```
